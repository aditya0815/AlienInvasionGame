var nx=nx||{};nx.iac=nx.iac||{},!function(a,b,c){function d(a){if("number"!=typeof a)throw new f("Wrong data type for flags. flags must be numeric.","Use_case_wrong_flagged");if(a=parseInt(a,10),nx.iac.type.USECASE&a&&nx.iac.type.EVENT&a)throw new f("You cannot flag a IAC message as USECASE and EVENT.","Use_case_wrong_flagged");if(!(nx.iac.type.USECASE&a||nx.iac.type.EVENT&a))throw new f("You must flag a IAC message as USECASE or EVENT","Use_case_wrong_flagged");if(nx.iac.type.RPC&a&&nx.iac.type.RPE&a)throw new f("You cannot flag a IAC message as RPC and RPE.","Use_case_wrong_flagged");if(!(nx.iac.type.RPC&a||nx.iac.type.RPE&a))throw new f("You must flag a IAC message as RPC or RPE","Use_case_wrong_flagged");if(nx.iac.type.INTERN&a&&nx.iac.type.EXTERN&a)throw new f("You cannot flag a IAC message as INTERN and EXTERN.","Use_case_wrong_flagged");if(!(nx.iac.type.INTERN&a||nx.iac.type.EXTERN&a))throw new f("You must flag a IAC message as INTERN or EXTERN","Use_case_wrong_flagged");return a}function e(a,b){var c=Array.prototype.slice(arguments,2);return function(){return a.apply(b,c.concat(Array.prototype.slice.call(arguments)))}}function f(a,b){this.name="IACError",this.message=[a,nx.iac.Debugger.enabled?"//wiki.intranet.1and1.com/bin/view/Ihapps/InterApplicationCommunication50Client#"+(b||""):""].join("\r\n")||"An unknown IAC error occured"}function g(){this.onMessage=function(){},this.onInitialized=function(){},this.init=function(){throw new f("Missing abstract IACTransport::init() method.")},this.initialized=function(){throw new f("Missing abstract IACTransport::initialized() method.")},this.send=function(a,b){throw new f("Missing abstract IACTransport::send() method.")}}function h(b){var d=!1;this.init=function(){var b=e(this.onMessageWrapper,this);a.addEventListener?a.addEventListener("message",b,!1):a.attachEvent("onmessage",b),d=!0,this.onInitialized()},this.initialized=function(){return d},this.onMessageWrapper=function(a){var b;try{b=JSON.parse(a.data)}catch(a){nx.iac.Debugger.hey().warn("Any unknownable post message protocol detected.")}finally{b&&this.onMessage(this.incomingMessageFactory(b))}},this.send=function(a,c){a=this.outgoingMessageFactory(a,c),(c?c.contentWindow:top).postMessage(JSON.stringify(a),"*")}}function i(){var a={type:0,sender:"",usecase:"",args:[]};this.setFlags=function(b){a.type|=b},this.getFlags=function(){return a.type},this.unsetFlag=function(b){for(var c=-1;Math.pow(2,++c)!=b;);return a.type&=~(1<<c),this},this.setSender=function(b){if("string"!=typeof b)throw new f("Wrong data type for sender. sender must be a type of string.");if(!b)throw new f("The sender cannot be empty.");return a.sender=b,this},this.getSender=function(){return a.sender},this.setName=function(b){if("string"!=typeof b)throw new f("Wrong data type for name. name must be a type of string.","Invalid_Use_case_name");if(!b)throw new f("The name cannot be empty.","Invalid_Use_case_name");return a.usecase=b,this},this.getName=function(){return a.usecase},this.setPayload=function(){return a.args=Array.prototype.slice.call(arguments),this},this.getPayload=function(){return a.args},this.getRawData=function(){return a}}function j(a,b){this.protocol=a,this.transport=b,this.pending=!0,this.send=function(a){if(a&&("object"!=typeof a||!a.contentWindow||!a.iacAppname))throw new f("No valid message target given.");return d(this.protocol.getFlags()),this.transport.initialized()?(this.pending=!1,this.transport.send(this.protocol.getRawData(),a)):this.pending=!0,this},this.isPending=function(){return!!this.pending},this.setName=function(a){return this.protocol.setName(a),this},this.getName=function(){return this.protocol.getName()},this.getSender=function(){return this.protocol.getSender()},this.setPayload=function(){return this.protocol.setPayload.apply(this.protocol,arguments),this},this.getPayload=function(){return this.protocol.getPayload()}}function k(){this.asRPE=function(){return this.protocol.unsetFlag(nx.iac.type.RPC).setFlags(nx.iac.type.RPE),this},this.asRPC=function(){return this.protocol.unsetFlag(nx.iac.type.RPE).setFlags(nx.iac.type.RPC),this},this.asIntern=function(){return this.protocol.unsetFlag(nx.iac.type.EXTERN).setFlags(nx.iac.type.INTERN),this},this.asExtern=function(){return this.protocol.unsetFlag(nx.iac.type.INTERN).setFlags(nx.iac.type.EXTERN),this}}function l(){}nx.iac.type={USECASE:1,EVENT:2,RPC:4,RPE:8,INTERN:16,EXTERN:32},f.prototype=Error.prototype,nx.iac.Debugger={enabled:!1,name:location.host+""+location.pathname,hey:function(){return this.enabled&&this.log("IAC("+this.name+"): "),this},log:function(){try{this.enabled&&a.console&&a.console.log&&a.console.log.apply(a.console,arguments)}catch(a){}return this},warn:function(){try{this.enabled&&a.console&&a.console.warn&&a.console.warn.apply(a.console,arguments)}catch(a){}return this},debug:function(){try{this.enabled&&a.console&&a.console.debug&&a.console.debug.apply(a.console,arguments)}catch(a){}return this}},g.prototype.incomingMessageFactory=function(a){var b,c=new i;if(!this.validateMessageData(a))return null;switch(c.setFlags(a.type),c.setName(a.usecase),c.setSender(a.sender),c.setPayload.apply(c,a.args),!0){case!!(nx.iac.type.USECASE&a.type):b=new k;break;case!!(nx.iac.type.EVENT&a.type):b=new l;break;default:throw new f("Invalid IAC message detected, which is not flagged as USECASE or EVENT.","Invalid_IAC_message_detected")}return b.protocol=c,b.transport=this,b},g.prototype.outgoingMessageFactory=function(a,b){return a},g.prototype.validateMessageData=function(a){return a&&a.sender&&a.type&&a.usecase},h.prototype=new g,h.prototype.constructor=g,k.prototype=new j,k.prototype.constructor=j,l.prototype=new j,l.prototype.constructor=j;var m=function(){var a,b,c,d,g=!1,j=[],m=[];this.init=function(d){if("object"!=typeof d)throw new f("init requires a plain configuration object.","Invalid_Initialization");if(!d.appname)throw new f("No valid IAC appname given.","Invalid_Initialization");if(!d.context_token)throw new f("No valid IAC token given.","Invalid_Initialization");return a=d,this.listen(nx.iac.type.USECASE,"__connected__",function(){g=!0,c()},this),this.listen(nx.iac.type.USECASE,"__disconnected__",function(){g=!1},this),b=new h(d),b.onMessage=e(this.onMessage,this),b.onInitialized=this.sendPendingMessages,b.init(),this},this.requiresInitialization=function(){if(!a)throw new f("IAC Client is not yet initialized.","Not_Initialized");return this},this.getAppname=function(){return a.appname||"unknown appname"},this.connect=function(a,b){return this.requiresInitialization(),c="function"==typeof a?a:function(){},d="function"==typeof b?b:function(){},this.createUsecase("__connect__").asRPE().send(),setTimeout(this.fireConnectError,2e3),this},this.disconnect=function(){return this.requiresInitialization(),this.createUsecase("__disconnect__").asRPE().send(),this},this.fireConnectError=function(){g||d()},this.isConnected=function(){return this.requiresInitialization(),g},this.connected=function(){return nx.iac.Debugger.hey().warn("You are using a the deprecated function nx.iac.Client::connected(). Please use nx.iac.Client::isConnected() instead."),this.isConnected()},this.sendPendingMessages=function(){for(var c,a=0,b=m.length;a<b;a++)c=m[a],c.isPending()&&c.send();return this},this.createUsecase=function(a,c){if(this.requiresInitialization(),"string"!=typeof a||!a)throw new f("An IAC use case name must be a string and cannot be empty.","Invalid_Use_case_name");var d=new k;return d.protocol=new i,d.transport=b,d.protocol.setFlags(nx.iac.type.USECASE|nx.iac.type.RPC|nx.iac.type.INTERN),d.protocol.setSender(this.getAppname()),d.setName(a),d.setPayload("object"==typeof c?c:{}),m.push(d),d},this.listen=function(a,b,c,d){if(this.requiresInitialization(),"number"!=typeof a)throw new f("Wrong data type for flags. flags must be numeric.","Use_case_wrong_flagged");if(a=parseInt(a,10),"string"!=typeof b)throw new f("Wrong data type for name. name must be a type of string.","Invalid_Use_case_name");if(!b)throw new f("The name cannot be empty.","Invalid_Use_case_name");if("function"!=typeof c)throw new f("No valid callback function given.","Missing_callback_function");return j.push({flags:a||nx.iac.type.USECASE|nx.iac.type.RPC|nx.iac.type.INTERN,name:b,callback:c,scope:d||c}),this},this.onMessage=function(a){if(this.requiresInitialization(),!(a instanceof k||a instanceof l))return void nx.iac.Debugger.hey().warn("Any unknown IAC message detected.");for(var d,e,f,b=0,c=j.length;b<c;b++)if(d=j[b],d.name==a.getName()){for(e=0,f=!0;e<32;e++)d.flags&1<<e&&(d.flags&1<<e)!=(a.protocol.getFlags()&1<<e)&&(f=!1);f&&d.callback.apply(d.scope,[a.getSender()].concat(a.getPayload()))}return this},this.invokeRPC=function(a){nx.iac.Debugger.hey().warn("You are using a the deprecated function nx.iac.Client::invokeRPC(). Please use nx.iac.Client::createUsecase() instead."),this.requiresInitialization();var c=new k;return c.protocol=new i,c.transport=b,c.protocol.setFlags(nx.iac.type.USECASE|nx.iac.type.RPC|nx.iac.type.INTERN),c.protocol.setSender(this.getAppname()),c.setName(a),c.setPayload.apply(c,Array.prototype.slice.call(arguments,1)),m.push(c.send()),this},this.invokeRPE=function(a){nx.iac.Debugger.hey().warn("You are using a the deprecated function nx.iac.Client::invokeRPE(). Please use nx.iac.Client::createUsecase() instead."),this.requiresInitialization();var c=new k;return c.protocol=new i,c.transport=b,c.protocol.setFlags(nx.iac.type.USECASE|nx.iac.type.RPE|nx.iac.type.INTERN),c.protocol.setSender(this.getAppname()),c.setName(a),c.setPayload.apply(c,Array.prototype.slice.call(arguments,1)),m.push(c.send()),this},this.bindUsecase=function(a,b){return nx.iac.Debugger.hey().warn("You are using a the deprecated function nx.iac.Client::bindUsecase(). Please use nx.iac.Client::listen() instead."),this.requiresInitialization(),this.listen(nx.iac.type.USECASE,a,b),this},this.unbindUsecase=function(a){nx.iac.Debugger.hey().warn("You are using a the deprecated function nx.iac.Client::unbindUsecase()."),this.requiresInitialization();for(var b=0,c=j.length,d=[];b<c;b++)j[b].name==a&&nx.iac.type.USECASE&j[b].flags&&d.push(b);for(;d.length;)j.splice(d.pop(),1);return this},this.bindEvent=function(a,b){return nx.iac.Debugger.hey().warn("You are using a the deprecated function nx.iac.Client::bindEvent(). Please use nx.iac.Client::listen() instead."),this.requiresInitialization(),this.listen(nx.iac.type.EVENT,a,b),this},this.unbindEvent=function(a){nx.iac.Debugger.hey().warn("You are using a the deprecated function nx.iac.Client::unbindEvent()."),this.requiresInitialization();for(var b=0,c=j.length,d=[];b<c;b++)j[b].name==a&&j[b].flags&nx.iac.type.EVENT&&d.push(b);for(;d.length;)j.splice(d.pop(),1);return this}};nx.iac.Client=new m,m.prototype.reinitializeApplication=function(){return this.createUsecase("reinitialize_application").send(),this},m.prototype.reinitializeNavigator=function(a){return this.createUsecase("reinitialize_navigator",a).send(),this},m.prototype.logoutNavigator=function(a){return this.createUsecase("logout_navigator",a).send(),this},m.prototype.openGotoFeature=function(a){return this.createUsecase("open_goto_feature",a).send(),this},m.prototype.openFeedbackDialog=function(){return this.createUsecase("open_feedback_dialog").send(),this},m.prototype.disableNavigator=function(){return this.createUsecase("disable_navigator").send(),this},m.prototype.enableNavigator=function(){return this.createUsecase("enable_navigator").send(),this},m.prototype.hideNavigator=function(){return this.createUsecase("hide_navigator").send(),this},m.prototype.showNavigator=function(){return this.createUsecase("show_navigator").send(),this},m.prototype.track=function(a){return this.createUsecase("tracking_track",a).asRPE().send(),this}}(window,document);